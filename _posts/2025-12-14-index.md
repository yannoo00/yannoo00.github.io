---
title:  "DB index - 클러스터/비클러스터"
layout: post
excerpt: "DB index"

categories:
  - DB 
tags:
  - [DB, MySQL]

toc: true
toc_sticky: true
 
date: 2025-12-22
last_modified_at: 2025-12-22
---

<br>

## Database Index

인덱스는 데이터베이스에서 검색 속도를 향상시키기 위한 자료구조다.

<br>

### Cluster Index

클러스터 인덱스는 테이블의 실제 데이터가 인덱스 키 순서대로 물리적으로 정렬되어 저장되는 방식이다.

**특징**
- 테이블당 하나만 존재할 수 있다
- Primary Key가 자동으로 클러스터 인덱스가 된다
- Primary Key가 없으면 Unique Key 중 첫 번째가 클러스터 인덱스가 된다
- 둘 다 없으면 내부적으로 숨겨진 행 ID를 생성하여 사용한다
- 리프 노드에 실제 데이터 페이지가 존재한다
- 범위 검색에 유리하다
- 데이터 삽입 시 정렬이 필요하므로 삽입 성능이 비클러스터 인덱스보다 느릴 수 있다


<br>

### Non-cluster Index

비클러스터 인덱스는 인덱스가 별도의 공간에 생성되며, 실제 데이터의 위치를 가리키는 포인터를 저장하는 방식이다.

**특징**
- 테이블당 여러 개 생성할 수 있다
- 일반적인 인덱스 생성 시 비클러스터 인덱스가 된다
- 리프 노드에 클러스터 키 값을 저장한다
- 실제 데이터에 접근하려면 클러스터 인덱스를 한 번 더 탐색해야 한다
- 데이터 정렬에 영향을 주지 않아 삽입 성능이 상대적으로 좋다
- 특정 컬럼 검색에 유리하다


<br>

### 성능 고려사항

**클러스터 인덱스 선택 기준**
- 범위 검색이 자주 발생하는 컬럼
- 순차적으로 증가하는 값 (Auto Increment 등)
- 크기가 작은 데이터 타입

**비클러스터 인덱스 사용 시 주의점**
- 너무 많은 인덱스는 쓰기 성능을 저하시킨다
- <b>선택도</b>가 높은 컬럼에 생성해야 효과적이다
- 복합 인덱스 사용 시 <b>컬럼 순서</b>가 중요하다  

여기서 선택도란, 중복이 적고 고유한 값이 많다는 의미이다.  
하나의 레코드가 한 명의 사람을 의미할 때 주민등록번호는 10,000개의 행에 대해 10,000개의 고유값을 가지므로 선택도가 1이다.  
선택했을 때 결과가 소수로 좁혀질 수 있는 인덱스가 효과적이다.  
하지만 선택도가 낮더라도 복합 인덱스로 만들어 선택도가 높은 column과 조합하면 효과적일 수 있다.  

복합 인덱스를 생성할 때에는 칼럼 순서에 유의해야 한다.  
일반적으로 선택도가 높은 컬럼, WHERER 절에서 = 조건으로 자주 사용되는 칼럼을 앞에 두고 범위 조건은 뒤에 둔다.  
인덱스를 A B C 로 생성한다면  
A로 정렬된 결과 안에서 같은 A 값을 가질 경우 B로 정렬하고, 그 다음 C 정렬로 이어지는 방식이기 때문에 A에서 선택되는 row 수를 최대한 줄이는게  효율적이다.  




